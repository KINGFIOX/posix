# chap6 - posix 针对线程的调整

## putchar 与 putchar_unlocked

`putchar` 和 `putchar_unlocked` 函数都用于输出一个字符到标准输出（通常是屏幕）。它们的主要区别在于线程安全性和性能。

1. **`putchar`**：

   - `putchar` 函数是线程安全的，在多线程环境中使用时可以保证字符正确输出，不会因为多线程同时操作而导致输出混乱。`putchar` 内部会对标准输出进行加锁和解锁操作，确保一次只有一个线程能够进行输出。
   - 由于加锁操作，`putchar` 的性能可能会稍低于 `putchar_unlocked`，特别是在高度并发的环境中。

2. **`putchar_unlocked`**：

   - `putchar_unlocked` 函数不是线程安全的。它不执行任何加锁操作，因此在多线程环境中使用时可能导致输出混乱，如果多个线程尝试同时调用 `putchar_unlocked` 输出到标准输出。
   - 由于省略了加锁和解锁操作，`putchar_unlocked` 的执行速度比 `putchar` 快。这在单线程环境中或者当你自己管理输出流的锁定时，可以提高程序的性能。

简而言之，如果你在编写单线程程序，或者已经通过其他方式确保了对标准输出访问的互斥（例如，通过手动控制输出的锁定和解锁），
使用 `putchar_unlocked` 可以获得更好的性能。反之，如果你在编写多线程程序，并且多个线程需要写入标准输出，
应该使用 `putchar` 来避免潜在的竞争条件和数据混乱。
